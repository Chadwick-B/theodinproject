(()=>{"use strict";const e=[{name:"Destroyer",size:2},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"Battleship",size:4},{name:"Carrier",size:5}],t=(t,n)=>{const s=[],i=[],a=()=>s,r=e=>!!(e=>{for(const i of e){for(const e of s)if(e.getVecs().some((e=>i.x===e.x&&i.y===e.y)))return!1;if(i.x>t-1||i.x<0)return!1;if(i.y>n-1||i.y<0)return!1}return!0})(e)&&(s.push((e=>{const t=[];return{getVecs:()=>e,getHits:()=>t,hit:(n,s)=>{const i=e.some((e=>n===e.x&&s===e.y&&!t.includes({x:n,y:s})));return i&&t.push({x:n,y:s}),i},isSunk:()=>t.length>=e.length}})(e)),!0);return{getShips:a,getWidth:()=>t,getHeight:()=>n,placeShip:r,placeRandomizedShips:()=>{const s=e.length-a().length,i=[];if(s>0){for(let e=0;e<t;e++)for(let t=0;t<n;t++)i.push({x:e,y:t});for(let t=s-1;t>=0;t--){const n=e[t];for(let e=0;e<i.length;e++){const e=[],t=[],s=Math.floor(Math.random()*i.length),a=i.splice(s,1)[0],o=Math.random()<.5;for(let s=0;s<n.size;s++)t.push({x:a.x+s,y:a.y}),e.push({x:a.x,y:a.y+s});if(o){if(r(t))break;if(r(e))break}else{if(r(e))break;if(r(t))break}}}}},receiveAttack:(e,t)=>{for(const n of s)if(n.hit(e,t))return!0;return i.push({x:e,y:t}),!1},isShipsSunk:()=>{for(const e of s)if(!e.isSunk())return!1;return!0}}},n=e=>{const t={name:e,history:[],lastAttack:{hit:!1,vec:{x:0,y:0}}},n=(e,n,s)=>{const i=e.getWidth(),a=e.getHeight();if(n>i-1||n<0)return null;if(s>a-1||s<0)return null;if(!t.history.some((e=>n===e.vec.x&&s===e.vec.y))){const i={hit:e.receiveAttack(n,s),vec:{x:n,y:s}};return t.lastAttack=i,t.history.push(i),i}return null};return{getData:()=>t,AIAttack:e=>{const s=e.getWidth(),i=e.getHeight(),a=s*i;if(t.history.length<a){const a=t.lastAttack.hit?[{x:(r=t.lastAttack.vec).x+1,y:r.y},{x:r.x-1,y:r.y},{x:r.x,y:r.y+1},{x:r.x,y:r.y-1}]:[];for(const t of a){const s=n(e,t.x,t.y);if(null!==s)return s}const o=[];for(let e=0;e<i;e++)for(let t=0;t<s;t++)o.push({x:t,y:e});for(;o.length>0;){const t=Math.floor(Math.random()*o.length),s=o.splice(t,1)[0],i=n(e,s.x,s.y);if(null!==i)return i}}var r;return null},attackBoard:n}},s=(()=>{const e="battleship",t=(e,t,n)=>{const s=document.createElement("div");s.classList.add("Grid"),s.setAttribute("data-player",e);for(let i=0;i<n;i++)for(let n=0;n<t;n++){const t=document.createElement("div");t.classList.add("Tile"),0!==e&&t.classList.add("Tile__Enemy"),t.setAttribute("data-x",n),t.setAttribute("data-y",i),t.setAttribute("style",`--xy: '${n}, ${i}'`),s.appendChild(t)}return s},n=(e,t,n)=>{const s=((e,t,n)=>{const s=`[data-x="${t}"]`,i=`[data-y="${n}"]`;return e.querySelector(s+i)})(e,t.x,t.y);s&&!s.classList.contains(n)&&s.classList.add(n)},s=(e,t,n)=>{const s=e.querySelectorAll(".Tile");for(const e of s){const s=parseInt(e.getAttribute("data-x")),i=parseInt(e.getAttribute("data-y"));e.addEventListener(t,(()=>n(s,i)),!1)}};return{renderPrep:(i,a,r)=>{const o=document.getElementById(e),l=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),h=document.createElement("button"),p=document.createElement("button"),m=t(0,a.getWidth(),a.getHeight());let f=null,g=0,y=!0,x=i[g].size;h.textContent="Rotate",p.textContent="Start Game",c.textContent="Place your ships",c.classList.add("Subtitle","Center"),l.classList.add("Container"),d.classList.add("Modal"),u.classList.add("Modal__Buttons"),h.classList.add("Modal__Button"),p.classList.add("Modal__Button"),h.addEventListener("click",(()=>{y=!y}),!1),p.addEventListener("click",(()=>{a.getShips().length>=i.length?(o.innerHTML="",r()):null===f&&(f=document.createElement("div"),f.classList.add("Modal__Error","Center"),f.textContent="Please add the remaining ships to the board.",d.appendChild(f))}),!1),s(m,"mouseover",((e,t)=>{for(let s=0;s<x;s++)n(m,y?{x:e+s,y:t}:{x:e,y:t+s},"Tile__Place")})),s(m,"mouseleave",(()=>(e=>{const t=e.querySelectorAll(".Tile__Place");for(const e of t)e.classList.remove("Tile__Place")})(m))),s(m,"click",((e,t)=>{const s=[];for(let n=0;n<x;n++){const i=y?{x:e+n,y:t}:{x:e,y:t+n};s.push(i)}if(a.placeShip(s)){for(const e of s)n(m,e,"Tile__Ship");g<i.length-1?(g++,x=i[g].size):x=0}})),u.appendChild(h),u.appendChild(p),d.appendChild(c),d.appendChild(m),d.appendChild(u),l.appendChild(d),o.appendChild(l)},renderGame:(i,a,r,o,l)=>{const c=document.getElementById(e),d=document.createElement("div"),u=document.createElement("div"),h=document.createElement("div"),p=document.createElement("div"),m=document.createElement("div"),f=t(0,r.getWidth(),r.getHeight()),g=t(1,o.getWidth(),o.getHeight());d.classList.add("Container"),h.classList.add("Center"),p.classList.add("Center"),h.textContent=i.getData().name,p.textContent=a.getData().name;const y=r.getShips();for(const e of y){const t=e.getVecs();for(const e of t)n(f,e,"Tile__Ship")}s(g,"click",((e,t)=>{const s=i.attackBoard(o,e,t);if(null!==s){n(g,s.vec,s.hit?"Tile__Hit":"Tile__Miss");for(const e of o.getShips())if(e.isSunk()){const t=e.getVecs();for(const e of t)n(g,e,"Tile__Sunk")}const e=a.AIAttack(r);if(null!==e){n(f,e.vec,e.hit?"Tile__Hit":"Tile__Miss");for(const e of r.getShips())if(e.isSunk()){const t=e.getVecs();for(const e of t)n(f,e,"Tile__Sunk")}}l()}})),u.appendChild(f),u.appendChild(h),m.appendChild(g),m.appendChild(p),d.appendChild(u),d.appendChild(m),c.appendChild(d)},renderEnd:t=>{const n=document.getElementById(e),s=document.createElement("div");s.classList.add("Subtitle","Center"),s.textContent=`${t} Won!`,n.appendChild(s)}}})();(()=>{const i=n("Player"),a=n("AI"),r=t(10,10),o=t(10,10);o.placeRandomizedShips();let l="",c=-1,d=0;const u=()=>d=1,h=()=>{o.isShipsSunk()?(l=i.getData().name,d=2):r.isShipsSunk()&&(l=a.getData().name,d=2)},p=()=>{if(c!==d){switch(d){case 0:s.renderPrep(e,r,u);break;case 1:s.renderGame(i,a,r,o,h);break;case 2:s.renderEnd(l)}c=d}window.requestAnimationFrame(p)};window.requestAnimationFrame(p)})()})();